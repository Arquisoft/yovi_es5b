ifndef::imagesdir[:imagesdir: ../images]

[[section-runtime-view]]
== Runtime View

A continuacion se presentan los distintos escenarios que describen las interacciones entre las instancias del sistema. Cada escenario se centra en un caso de uso específico, que seran:

* Registro de un nuevo usuario
* Inicio de sesión
* Partida de juego
* Consultar ranking de jugadores


=== Registro de un nuevo usuario
Al entrar por primera vez a la aplicación, el usuario se encuentra con la pantalla de registro. En esta pantalla, el usuario introduce sus datos y al hacer clic en el botón de registro, se envía una solicitud al servidor para crear una nueva cuenta. Si es valida se crea la cuenta y se muestra un mensaje de éxito, de lo contrario se muestra un mensaje de error indicando el motivo del fallo.

[plantuml, registro_usuario, png]
----
@startuml
actor Usuario
participant Webapp as "Webapp"
participant Users as "Users Service"
database DB as "DataBase"

Usuario -> Webapp: Rellena formulario y pulsa "Register"
Webapp -> Users: Envio de los datos de registro
Users -> DB: Validar y procesar datos
DB -> Users: Confirmar datos validos
Users --> Webapp: Mensaje de bienvenida
Webapp -> Usuario: Muestra confirmación en pantalla
@enduml
----

=== Inicio de sesión
Tras crear un usuario, el usuario puede iniciar sesión en la aplicación. En la pantalla de inicio de sesión, el usuario introduce su nombre de usuario y contraseña. Al hacer clic en el botón de inicio de sesión, se envía una solicitud al servidor para autenticar al usuario. Si las credenciales son correctas, se muestra la pantalla principal de la aplicación, de lo contrario se muestra un mensaje de error indicando que las credenciales son incorrectas.

[plantuml, inicio_sesion_usuario, png]
----
@startuml
actor Usuario
participant Webapp as "Webapp"
participant Users as "Users Service"
database DB as "DataBase"

Usuario -> Webapp: escribe sus credenciales
Webapp -> Users: Envio de los datos de inicio de sesión

activate Users
Users -> DB: Validar y procesar datos

activate DB
DB -> Users: Confirmar datos correctos
deactivate DB

alt Credenciales válidas
    Users --> Webapp: Mensaje de bienvenida
    Webapp -> Usuario: Pasa a la pagina principal
    
else Credenciales incorrectas
    Users --> Webapp: Error por datos invalidos/incorrectos
    deactivate Users
    Webapp -> Usuario: Mostrar "Usuario o contraseña incorrectos"
    Usuario -> Usuario: Pantalla de inicio de sesion
end
@enduml
----

=== Secuencia de partida de juego
Una vez que el usuario ha iniciado sesión, puede comenzar una partida de juego. Al hacer clic en el botón "Start Game", se envía una solicitud al servidor para iniciar una nueva partida. El servidor responde con los detalles de la partida, como el número de jugadores y el estado del juego. La aplicación muestra la pantalla de juego con la información recibida.

[plantuml, inicio_sesion_usuario, png]
----
@startuml
actor Usuario
participant Webapp as "Webapp"
participant GameY as "GameY Engine"
database db as "DataBase"

Usuario -> Webapp: Escoge modo de juego
Webapp -> GameY: Comienza el juego
activate GameY

loop Hasta que un jugador gane
GameY -> GameY: Jugador 1 coloca pieza
GameY -> GameY: Jugador 2 coloca pieza
end

GameY --> Webapp: Devolver resultados
deactivate GameY
Webapp -> Usuario: Mostrar resultados

opt Si se quieren registrar los resultados
Usuario -> Webapp: Guardar puntuación
Webapp -> db: Registrar resultados

end
@enduml
----